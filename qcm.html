<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de QCM</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f4f7f6; padding: 20px; color: #333; padding-bottom: 80px;}
        h1 { color: #2c3e50; text-align: center; }
        .container { max-width: 600px; margin: 0 auto; }
        
        textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-family: monospace; margin-bottom: 10px; resize: vertical;}
        
        .btn { display: block; width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; text-align: center; text-decoration: none;}
        .btn-primary { background-color: #3498db; color: white; }
        .btn-secondary { background-color: #95a5a6; color: white; }
        .btn-option { background-color: white; border: 2px solid #ddd; color: #333; transition: 0.2s; text-align: left;}
        
        .btn-option:hover { background-color: #f0f0f0; }
        .correct { background-color: #2ecc71 !important; border-color: #2ecc71; color: white; }
        .wrong { background-color: #e74c3c !important; border-color: #e74c3c; color: white; }
        
        .quiz-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 20px; display: none; }
        .question-text { font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; }
        .score-board { text-align: center; margin-top: 20px; font-weight: bold; color: #7f8c8d; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <a href="index.html" class="btn btn-secondary">‚¨ÖÔ∏è Retour au Dashboard</a>

        <h1>‚ö° G√©n√©rateur de QCM</h1>

        <div id="setupScreen">
            <p style="font-size: 0.9rem; color: #666;">
                <strong>Format :</strong> Question, puis Bonne r√©ponse, puis Mauvaises r√©ponses.<br>
                S√©pare chaque question par 3 tirets "---".
            </p>
            <textarea id="rawInput" placeholder="Question 1 ?
Bonne r√©ponse
Mauvaise 1
Mauvaise 2
---
Question 2 ?
Bonne r√©ponse
Mauvaise 1"></textarea>
            <button class="btn btn-primary" onclick="startQuiz()">Lancer le Quiz</button>
        </div>

        <div id="quizScreen" class="quiz-card">
            <div id="questionText" class="question-text"></div>
            <div id="optionsContainer"></div>
            <div id="feedback" style="text-align:center; margin:10px; font-weight:bold; min-height: 24px;"></div>
            <button id="nextBtn" class="btn btn-primary hidden" onclick="nextQuestion()">Question Suivante ‚û°Ô∏è</button>
            <div class="score-board">Question <span id="currentQ">0</span> / <span id="totalQ">0</span></div>
        </div>
        
        <div id="endScreen" class="quiz-card" style="text-align: center; display:none;">
            <h2>Quiz Termin√© ! üèÅ</h2>
            <p>Ton score : <strong id="finalScore" style="font-size: 1.5rem;"></strong></p>
            <button class="btn btn-primary" onclick="location.reload()">Recommencer</button>
        </div>
    </div>

    <script>
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;

        function startQuiz() {
            const text = document.getElementById('rawInput').value;
            if (!text.trim()) return alert("Colle du texte d'abord !");

            questions = parseText(text);
            
            if (questions.length === 0) return alert("Je n'ai trouv√© aucune question. V√©rifie que tu as bien mis '---' entre les blocs.");
            
            if (questions.length === 1 && text.length > 200) {
                if(!confirm("Attention : Je n'ai d√©tect√© qu'une seule question. Es-tu s√ªr d'avoir mis les s√©parateurs '---' ?")) return;
            }

            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('quizScreen').style.display = 'block';
            
            currentQuestionIndex = 0;
            score = 0;
            showQuestion();
        }

        function parseText(raw) {
            // 1. Nettoyage basique
            let clean = raw.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            
            // 2. D√©coupage intelligent : on coupe sur "---" OU sur 2 sauts de ligne
            // Le regex signifie : soit "---" entour√© de sauts de ligne, soit 2 sauts de ligne cons√©cutifs
            const blocks = clean.split(/\n\s*---\s*\n|\n\s*\n/);
            
            const parsed = [];

            blocks.forEach(block => {
                // On nettoie les lignes vides au d√©but ou √† la fin du bloc
                const lines = block.split('\n').map(l => l.trim()).filter(l => l !== "" && l !== "---");
                
                // Il faut au moins une question + 1 bonne r√©ponse + 1 mauvaise r√©ponse (3 lignes min)
                if (lines.length >= 3) {
                    parsed.push({
                        q: lines[0],
                        correct: lines[1], // La premi√®re r√©ponse est la bonne
                        others: lines.slice(2) // Les autres sont fausses
                    });
                }
            });
            return parsed;
        }

        function showQuestion() {
            const qData = questions[currentQuestionIndex];
            document.getElementById('questionText').textContent = qData.q;
            document.getElementById('currentQ').textContent = currentQuestionIndex + 1;
            document.getElementById('totalQ').textContent = questions.length;
            document.getElementById('feedback').textContent = "";
            document.getElementById('nextBtn').classList.add('hidden');

            // M√©lange des r√©ponses
            let allOptions = [
                { text: qData.correct, isCorrect: true },
                ...qData.others.map(txt => ({ text: txt, isCorrect: false }))
            ];
            // M√©lange al√©atoire
            allOptions = allOptions.sort(() => Math.random() - 0.5);

            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';

            allOptions.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-option';
                btn.textContent = opt.text;
                btn.onclick = () => checkAnswer(btn, opt.isCorrect);
                container.appendChild(btn);
            });
        }

        function checkAnswer(btn, isCorrect) {
            const allBtns = document.querySelectorAll('.btn-option');
            allBtns.forEach(b => b.disabled = true); // Emp√™che de re-cliquer

            if (isCorrect) {
                btn.classList.add('correct');
                document.getElementById('feedback').textContent = "‚úÖ Bonne r√©ponse !";
                document.getElementById('feedback').style.color = "#2ecc71";
                score++;
            } else {
                btn.classList.add('wrong');
                document.getElementById('feedback').textContent = "‚ùå Rat√© !";
                document.getElementById('feedback').style.color = "#e74c3c";
                
                // Montre la bonne r√©ponse
                allBtns.forEach(b => {
                    // Comparaison simple du texte
                    if (b.textContent === questions[currentQuestionIndex].correct) {
                        b.classList.add('correct');
                    }
                });
            }
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                document.getElementById('quizScreen').style.display = 'none';
                document.getElementById('endScreen').style.display = 'block';
                document.getElementById('finalScore').textContent = `${score} / ${questions.length}`;
            }
        }
    </script>
</body>
</html>
